<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.mycompany.daon.boardmapper">
	<select id = "getBoardList" parameterType="com.mycompany.daon.BoardForm" resultType="com.mycompany.daon.BoardDto">
		SELECT 
		 BOARD_NO, 
		 BOARD_TITLE,
		 CAST( DATE_FORMAT( REG_DATE, '%Y-%m-%d') AS CHAR(10) ) AS REG_DATE,
		 BOARD_WRITER
			from tb_recruit_board
			order by board_no desc
	</select>
	
	<select id = "getBoardCount" resultType="int">
		SELECT 
		 COUNT(*)
			from tb_recruit_board
	</select>
	
	<select id="getBoardDetail" parameterType="com.mycompany.daon.BoardForm" resultType="com.mycompany.daon.BoardDto">
    
        SELECT 
        	BOARD_NO,
        	BOARD_TITLE,
        	BOARD_CONTENT,
        	CAST( DATE_FORMAT( REG_DATE, '%Y-%m-%d' ) AS CHAR(10) ) AS REG_DATE
        FROM tb_recruit_board
        WHERE BOARD_NO = #{board_no}
    </select>
    
    <select id="getBoardFileList" parameterType="com.mycompany.daon.BoardFileForm" resultType="com.mycompany.daon.BoardFileDto">
    
        SELECT T1.*
        FROM (
                SELECT BOARD_NO
                     , FILE_NO
                     , FILE_NAME_KEY
                     , FILE_NAME
                     , FILE_PATH
                     , FILE_SIZE
                     
                FROM TB_RECRUIT_BOARD_FILE
                WHERE BOARD_NO = #{board_no}
              ) T1        
            
    </select>
	
	<select id="getBoardReRef" parameterType="com.mycompany.daon.BoardForm" resultType="int">
    
        SELECT IFNULL(MAX(board_re_ref), 0) + 1
        FROM tb_recruit_board
    
    </select>
	
	 <insert id="insertBoard" parameterType="com.mycompany.daon.BoardForm">
    
    	<selectKey resultType="int" keyProperty="board_no" order="AFTER">
 
            SELECT LAST_INSERT_ID()
 
        </selectKey>
    
        INSERT 
        INTO tb_recruit_board 
        (
        	board_re_ref,
			BOARD_TITLE,
			BOARD_CONTENT,
			REG_DATE,
			BOARD_WRITER
        ) 
        VALUES 
        (
        	#{board_re_ref}
            ,#{board_title}
            , #{board_content}
            , NOW()
            , '관리자'
        )
    
    </insert>
    
    <insert id="insertBoardFile" parameterType="com.mycompany.daon.BoardFileForm">
    	
    	<selectKey resultType="int" keyProperty="file_no" order="BEFORE">
            
            SELECT IFNULL(MAX(FILE_NO), 0) + 1 
            FROM TB_RECRUIT_BOARD_FILE
            WHERE BOARD_NO = #{board_no}
              
        </selectKey>
        
		    INSERT 
		    INTO
		    TB_RECRUIT_BOARD_FILE 
		    (
		    	board_no,
		    	file_no,
		    	file_name_key,
		    	file_name,
		    	file_path,
		    	file_size,
		    	reg_date
		    )
		     VALUES 
		     (
		     	  #{board_no}
	            , #{file_no}
	            , #{file_name_key}
	            , #{file_name}
	            , #{file_path}
	            , #{file_size}
			     , NOW()
			  )
    </insert>
    
    <delete id="deleteBoard" parameterType="com.mycompany.daon.BoardForm">
    
        DELETE 
        FROM tb_recruit_board 
        WHERE BOARD_NO = #{board_no}
    
    </delete>
    
    <delete id="updateBoard" parameterType="com.mycompany.daon.BoardForm">
    
        UPDATE tb_recruit_board
           SET BOARD_TITLE = #{board_title}
             , BOARD_CONTENT = #{board_content}
             , REG_DATE = NOW()
         WHERE BOARD_NO = #{board_no}
    
    </delete>
	
</mapper>